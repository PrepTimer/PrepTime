name: build

on:
  push: # Run this workflow on every push to any branch
  workflow_dispatch: # Allow workflow to be run manually
  schedule:
    - cron: '0 0 * * 0' # “At 00:00 (UTC) every Sunday.”

jobs:
  # Set up Flutter for all other tasks.
  setup:
    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest]
        include:
          - os: ubuntu-latest
            flutter_path: /opt/hostedtoolcache/flutter
          - os: macos-latest
            flutter_path: /Users/runner/hostedtoolcache/flutter
      fail-fast: false

    steps:
      # Checkout the current repository
      - id: checkout
        name: Checking Out Repo...
        uses: actions/checkout@v2
      
      # Cach the dependencies from flutter
      - name: Caching Flutter Dependencies...
        uses: actions/cache@v1
        with:
          path: ${{ matrix.flutter_path }}
          key: ${{ runner.os }}-flutter
      
      # Set up a flutter environment
      - id: flutter
        name: Settting Up Flutter...
        uses: subosito/flutter-action@v1
        with:
          channel: 'stable'

  lint:
    runs-on: ${{ matrix.os }}
    needs: setup

    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest]
        include:
          - os: ubuntu-latest
            flutter_path: /opt/hostedtoolcache/flutter
          - os: macos-latest
            flutter_path: /Users/runner/hostedtoolcache/flutter
      fail-fast: false

    steps:
      # Checkout the current repository
      - id: checkout
        name: Checking Out Repo...
        uses: actions/checkout@v2
      
      # Cach the dependencies from flutter
      - name: Caching Flutter Dependencies...
        uses: actions/cache@v1
        with:
          path: ${{ matrix.flutter_path }}
          key: ${{ runner.os }}-flutter
      
      # Set up a flutter environment
      - id: flutter
        name: Settting Up Flutter...
        uses: subosito/flutter-action@v1
        with:
          channel: 'stable'
      
      # Install the package dependencies
      - id: dependencies
        name: Installing Dependencies...
        run: flutter pub get
        
      # Run the dart Linter
      - id: lint
        name: Linting Dart Files...
        run: flutter analyze

    # Run the unit tests
#   - id: unit_test:
#       name: Unit Testing...
#       run: flutter test
  
    # Run the widget tests
#   - id: widget_test:
#       name: Widget Testing...
#       run: flutter widget_tests.dart

    # Run the integration tests
#   - id: integration_test:
#       name: Integration Test
#       run: flutter integration_tests.dart
  
    # Deploy the build to the app stores
#   - id: deploy
#       name: Deploying App...
#       run: ## TODO

