# Run the unit tests
#   unit_test:
#     name: Unit Test
#     needs: dart_lint
  
  # Run the widget tests
#   widget_test:
#     name: Widget Test
#     needs: unit_test

  # Run the integration tests
#   integration_test:
#     name: Integration Test
#     needs: widget_test
  
  # Deploy the build to the app stores
#   deploy:
#     name: Deploy App
#     needs: integration_test
#     strategy:
#       matrix:
#         platform: [iOS, Android]

#   labeler:
#     if: always() 
#     runs-on: ubuntu-latest
#     steps
#       - id: 

name: build

on:
  push: # Run this workflow on every push to any branch
  workflow_dispatch: # Allow workflow to be run manually
  schedule:
    - cron: '0 0 * * 0' # “At 00:00 (UTC) every Sunday.”

jobs:
  # Set up Flutter for all other tasks.
  setup:
    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest]
        include:
          - os: ubuntu-latest
            flutter_path: /opt/hostedtoolcache/flutter
          - os: macos-latest
            flutter_path: /Users/runner/hostedtoolcache/flutter
      fail-fast: false

    steps:
      # Checkout the current repository
      - id: checkout
        name: Checking Out Repo...
        uses: actions/checkout@v2
      
      # Cach the dependencies from flutter
      - name: Caching Flutter Dependencies...
        uses: actions/cache@v1
        with:
          path: ${{ matrix.flutter_path }}
          key: ${{ runner.os }}-flutter
      
      # Set up a flutter environment
      - id: flutter
        name: Settting Up Flutter...
        uses: subosito/flutter-action@v1
        with:
          channel: 'stable'

  lint:
    runs-on: ${{ matrix.os }}
    needs: setup

    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest]
        include:
          - os: ubuntu-latest
            flutter_path: /opt/hostedtoolcache/flutter
          - os: macos-latest
            flutter_path: /Users/runner/hostedtoolcache/flutter
      fail-fast: false

    steps:
      # Checkout the current repository
      - id: checkout
        name: Checking Out Repo...
        uses: actions/checkout@v2
      
      # Cach the dependencies from flutter
      - name: Caching Flutter Dependencies...
        uses: actions/cache@v1
        with:
          path: ${{ matrix.flutter_path }}
          key: ${{ runner.os }}-flutter
      
      # Set up a flutter environment
      - id: flutter
        name: Settting Up Flutter...
        uses: subosito/flutter-action@v1
        with:
          channel: 'stable'
      
      # Install the package dependencies
      - id: dependencies
        name: Installing Dependencies...
        run: flutter pub get
        
      # Run the dart Linter
      - id: lint
        name: Linting Dart Files...
        run: flutter analyze
